<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1014px" preserveAspectRatio="none" style="width:2835px;height:1014px;" version="1.1" viewBox="0 0 2835 1014" width="2835px" zoomAndPan="magnify"><defs><filter height="300%" id="f5d46258a29bh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="1886.6875" cy="20" fill="#000000" filter="url(#f5d46258a29bh)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><path d="M1952.6875,40 L1952.6875,135.8948 L1932.6875,139.8948 L1952.6875,143.8948 L1952.6875,239.7896 A0,0 0 0 0 1952.6875,239.7896 L2823.6875,239.7896 A0,0 0 0 0 2823.6875,239.7896 L2823.6875,50 L2813.6875,40 L1952.6875,40 A0,0 0 0 0 1952.6875,40 " fill="#FBFB77" filter="url(#f5d46258a29bh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2813.6875,40 L2813.6875,50 L2823.6875,50 L2813.6875,40 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="1958.6875" y="59.8979">React为了提高对比效率，做出以下假设：</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="67.7544" y2="67.7544"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="69.7544" y2="69.7544"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="481" x="1958.6875" y="87.6523">假设节点不会出现层次的移动（对比时，直接找到旧树中对应位置的节点进行对比）</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="95.5088" y2="95.5088"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="97.5088" y2="97.5088"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1958.6875" y="115.4067">不同的节点类型会生成不同的结构</text><ellipse cx="1964.1875" cy="128.5176" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="1971.6875" y="133.1611">相同的节点类型：节点本身类型相同，如果是由React元素生成，type值还必须一致</text><ellipse cx="1964.1875" cy="146.272" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1971.6875" y="150.9155">其他的，都属于不相同的节点类型</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="158.772" y2="158.772"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1952.6875" x2="2823.6875" y1="160.772" y2="160.772"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="294" x="1958.6875" y="178.6699">多个兄弟通过唯一标识（key）来确定对比的新节点</text><ellipse cx="1964.1875" cy="191.7808" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="1971.6875" y="196.4243">key值的作用</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="480" x="2053.6875" y="196.4243">： 用于通过旧节点，寻找对应的新节点，如果某个旧节点有key值，则其更新时，会</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98" x="2533.6875" y="196.4243">寻找相同层级中</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="2631.6875" y="196.4243">的相同key值的节点，进行对比</text><ellipse cx="1964.1875" cy="209.5352" fill="#000000" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 0.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="372" x="1971.6875" y="214.1787">key值应该在一个范围内唯一（兄弟节点中），并且应该保持稳定</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1962.6875" y="231.9331"/><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="1840.6875" y="121.7004"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="1850.6875" y="145.4524">寻找对比目标</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1842.6875,259.7896,1930.6875,259.7896,1942.6875,271.7896,1930.6875,283.7896,1842.6875,283.7896,1830.6875,271.7896,1842.6875,259.7896" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="88" x="1842.6875" y="276.884">是否找到对比目标</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="11" x="1819.6875" y="269.3726">是</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="11" x="1942.6875" y="269.3726">否</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1390.375,293.7896,1500.375,293.7896,1512.375,305.7896,1500.375,317.7896,1390.375,317.7896,1378.375,305.7896,1390.375,293.7896" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="1390.375" y="310.884">判断节点类型是否一致</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="11" x="1367.375" y="303.3726">是</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="11" x="1512.375" y="303.3726">否</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="92" x="824.5" y="327.7896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="834.5" y="351.5415">判断节点类型</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="33.5,424.1782,66.5,424.1782,78.5,436.1782,66.5,448.1782,33.5,448.1782,21.5,436.1782,33.5,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="33" x="33.5" y="441.2727">空节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="10" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="60" x="20" y="491.9302">什么都不做</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="285.5,424.1782,330.5,424.1782,342.5,436.1782,330.5,448.1782,285.5,448.1782,273.5,436.1782,285.5,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="285.5" y="441.2727">DOM节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="218.5" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="159" x="228.5" y="491.9302">直接重用之前的真实DOM对象</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="416" x="100" y="539.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="396" x="110" y="563.3188">将其属性的变化记录下来，以待将来统一完成更新（现在不会真正的变化）</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="274" x="171" y="610.9556"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="176" x="181" y="634.7075">遍历该新的React元素的子元素，</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="357" y="634.7075">递归对比更新</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="634,424.1782,678,424.1782,690,436.1782,678,448.1782,634,448.1782,622,436.1782,634,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="634" y="441.2727">文本节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="182" x="565" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="159" x="575" y="491.9302">直接重用之前的真实DOM对象</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="260" x="526" y="539.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="240" x="536" y="563.3188">将新的文本变化记录下来，将来统一完成更新</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="931,424.1782,975,424.1782,987,436.1782,975,448.1782,931,448.1782,919,436.1782,931,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="931" y="441.2727">函数组件</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="314" x="796" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="216" x="806" y="491.9302">重新调用函数，得到一个节点对象，进入</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="1022" y="491.9302">递归对比更新</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1254.5,424.1782,1287.5,424.1782,1299.5,436.1782,1287.5,448.1782,1254.5,448.1782,1242.5,436.1782,1254.5,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="33" x="1254.5" y="441.2727">类组件</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="107" x="1217.5" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="1227.5" y="491.9302">重用之前的实例</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="297" x="1122.5" y="539.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="277" x="1132.5" y="563.3188">调用生命周期方法static getDerivedStateFromProps</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="259" x="1141.5" y="610.9556"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="239" x="1151.5" y="634.7075">调用生命周期方法shouldComponentUpdate</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="302" x="1120" y="731.8557"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="204" x="1130" y="755.6077">运行render，得到新的节点对象，进入</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="1334" y="755.6077">递归对比更新</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="274" x="1134" y="788.2444"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="254" x="1144" y="811.9963">将该对象的getSnapshotBeforeUpdate加入队列</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="249" x="1146.5" y="844.6331"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="229" x="1156.5" y="868.385">将该对象的componentDidUpdate加入队列</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1194.5,682.3442,1347.5,682.3442,1359.5,694.3442,1347.5,706.3442,1194.5,706.3442,1182.5,694.3442,1194.5,682.3442" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="19" x="1275" y="718.9502">true</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="153" x="1194.5" y="699.4387">shouldComponentUpdate返回值</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="24" x="1359.5" y="691.9272">false</text><ellipse cx="1405.5" cy="694.3442" fill="#FFFFFF" filter="url(#f5d46258a29bh)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="1405.5" cy="694.3442" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1584,424.1782,1628,424.1782,1640,436.1782,1628,448.1782,1584,448.1782,1572,436.1782,1584,424.1782" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="1584" y="441.2727">组件节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="1521" y="468.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="1531" y="491.9302">遍历数组进行</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="78" x="1603" y="491.9302">递归对比更新</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="203" x="1886.75" y="327.7896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="183" x="1896.75" y="351.5415">创建新节点,进入新节点的渲染流程</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="1948.25" y="399.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="60" x="1958.25" y="422.9302">卸载旧节点</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1966.25,470.5669,2010.25,470.5669,2022.25,482.5669,2010.25,494.5669,1966.25,494.5669,1954.25,482.5669,1966.25,470.5669" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="1966.25" y="487.6614">节点类型</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="1899.25" y="480.1499">类组件节点</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="2022.25" y="480.1499">其他节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1790.5" y="504.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="1800.5" y="528.3188">直接放弃该节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="247" x="1719" y="575.9556"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="227" x="1729" y="599.7075">调用该节点的componentWillUnMount函数</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1790.5" y="647.3442"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="1800.5" y="671.0962">递归卸载子节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="296" x="1986" y="504.5669"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="276" x="1996" y="528.3188">直接放弃该节点，如果节点有子节点，递归卸载节点</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1988.25,689.7329,2000.25,701.7329,1988.25,713.7329,1976.25,701.7329,1988.25,689.7329" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1445.375,907.0217,1457.375,919.0217,1445.375,931.0217,1433.375,919.0217,1445.375,907.0217" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="2322" y="293.7896"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="2332" y="317.5415">创建新加入的节点</text><rect fill="#FEFECE" filter="url(#f5d46258a29bh)" height="36.3887" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="116" x="2322" y="365.1782"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="2332" y="388.9302">卸载多余的旧节点</text><polygon fill="#FEFECE" filter="url(#f5d46258a29bh)" points="1886.6875,937.0217,1898.6875,949.0217,1886.6875,961.0217,1874.6875,949.0217,1886.6875,937.0217" style="stroke: #A80036; stroke-width: 1.5;"/><ellipse cx="1886.6875" cy="992.0217" fill="#FFFFFF" filter="url(#f5d46258a29bh)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="1886.6875" cy="992.0217" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1886.6875" x2="1886.6875" y1="30" y2="121.7004"/><polygon fill="#A80036" points="1882.6875,111.7004,1886.6875,121.7004,1890.6875,111.7004,1886.6875,115.7004" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308" x2="308" y1="504.5669" y2="539.5669"/><polygon fill="#A80036" points="304,529.5669,308,539.5669,312,529.5669,308,533.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308" x2="308" y1="575.9556" y2="610.9556"/><polygon fill="#A80036" points="304,600.9556,308,610.9556,312,600.9556,308,604.9556" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="656" x2="656" y1="504.5669" y2="539.5669"/><polygon fill="#A80036" points="652,529.5669,656,539.5669,660,529.5669,656,533.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="504.5669" y2="539.5669"/><polygon fill="#A80036" points="1267,529.5669,1271,539.5669,1275,529.5669,1271,533.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="575.9556" y2="610.9556"/><polygon fill="#A80036" points="1267,600.9556,1271,610.9556,1275,600.9556,1271,604.9556" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="768.2444" y2="788.2444"/><polygon fill="#A80036" points="1267,778.2444,1271,788.2444,1275,778.2444,1271,782.2444" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="824.6331" y2="844.6331"/><polygon fill="#A80036" points="1267,834.6331,1271,844.6331,1275,834.6331,1271,838.6331" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="706.3442" y2="731.8557"/><polygon fill="#A80036" points="1267,721.8557,1271,731.8557,1275,721.8557,1271,725.8557" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1359.5" x2="1394.5" y1="694.3442" y2="694.3442"/><polygon fill="#A80036" points="1384.5,690.3442,1394.5,694.3442,1384.5,698.3442,1388.5,694.3442" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="881.0217" y2="901.0217"/><polygon fill="#A80036" points="1267,891.0217,1271,901.0217,1275,891.0217,1271,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="647.3442" y2="682.3442"/><polygon fill="#A80036" points="1267,672.3442,1271,682.3442,1275,672.3442,1271,676.3442" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="50" x2="50" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="46,458.1782,50,468.1782,54,458.1782,50,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="50" x2="50" y1="504.5669" y2="901.0217"/><polygon fill="#A80036" points="46,891.0217,50,901.0217,54,891.0217,50,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308" x2="308" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="304,458.1782,308,468.1782,312,458.1782,308,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="308" x2="308" y1="647.3442" y2="901.0217"/><polygon fill="#A80036" points="304,891.0217,308,901.0217,312,891.0217,308,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="656" x2="656" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="652,458.1782,656,468.1782,660,458.1782,656,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="656" x2="656" y1="575.9556" y2="901.0217"/><polygon fill="#A80036" points="652,891.0217,656,901.0217,660,891.0217,656,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="953" x2="953" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="949,458.1782,953,468.1782,957,458.1782,953,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="953" x2="953" y1="504.5669" y2="901.0217"/><polygon fill="#A80036" points="949,891.0217,953,901.0217,957,891.0217,953,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1271" x2="1271" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="1267,458.1782,1271,468.1782,1275,458.1782,1271,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1606" x2="1606" y1="448.1782" y2="468.1782"/><polygon fill="#A80036" points="1602,458.1782,1606,468.1782,1610,458.1782,1606,462.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1606" x2="1606" y1="504.5669" y2="901.0217"/><polygon fill="#A80036" points="1602,891.0217,1606,901.0217,1610,891.0217,1606,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="78.5" x2="273.5" y1="436.1782" y2="436.1782"/><polygon fill="#A80036" points="263.5,432.1782,273.5,436.1782,263.5,440.1782,267.5,436.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="342.5" x2="622" y1="436.1782" y2="436.1782"/><polygon fill="#A80036" points="612,432.1782,622,436.1782,612,440.1782,616,436.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="690" x2="919" y1="436.1782" y2="436.1782"/><polygon fill="#A80036" points="909,432.1782,919,436.1782,909,440.1782,913,436.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="987" x2="1242.5" y1="436.1782" y2="436.1782"/><polygon fill="#A80036" points="1232.5,432.1782,1242.5,436.1782,1232.5,440.1782,1236.5,436.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1299.5" x2="1572" y1="436.1782" y2="436.1782"/><polygon fill="#A80036" points="1562,432.1782,1572,436.1782,1562,440.1782,1566,436.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="870.5" x2="870.5" y1="364.1782" y2="399.1782"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="870.5" x2="50" y1="399.1782" y2="399.1782"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="50" x2="50" y1="399.1782" y2="424.1782"/><polygon fill="#A80036" points="46,414.1782,50,424.1782,54,414.1782,50,418.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1640" x2="1705" y1="436.1782" y2="436.1782"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1705" x2="1705" y1="436.1782" y2="901.0217"/><polygon fill="#A80036" points="1701,891.0217,1705,901.0217,1709,891.0217,1705,895.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="50" x2="1705" y1="901.0217" y2="901.0217"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1988.25" x2="1988.25" y1="364.1782" y2="399.1782"/><polygon fill="#A80036" points="1984.25,389.1782,1988.25,399.1782,1992.25,389.1782,1988.25,393.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1842.5" x2="1842.5" y1="540.9556" y2="575.9556"/><polygon fill="#A80036" points="1838.5,565.9556,1842.5,575.9556,1846.5,565.9556,1842.5,569.9556" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1842.5" x2="1842.5" y1="612.3442" y2="647.3442"/><polygon fill="#A80036" points="1838.5,637.3442,1842.5,647.3442,1846.5,637.3442,1842.5,641.3442" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1954.25" x2="1842.5" y1="482.5669" y2="482.5669"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1842.5" x2="1842.5" y1="482.5669" y2="504.5669"/><polygon fill="#A80036" points="1838.5,494.5669,1842.5,504.5669,1846.5,494.5669,1842.5,498.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2022.25" x2="2134" y1="482.5669" y2="482.5669"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2134" x2="2134" y1="482.5669" y2="504.5669"/><polygon fill="#A80036" points="2130,494.5669,2134,504.5669,2138,494.5669,2134,498.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1842.5" x2="1842.5" y1="683.7329" y2="701.7329"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1842.5" x2="1976.25" y1="701.7329" y2="701.7329"/><polygon fill="#A80036" points="1966.25,697.7329,1976.25,701.7329,1966.25,705.7329,1970.25,701.7329" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2134" x2="2134" y1="540.9556" y2="701.7329"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2134" x2="2000.25" y1="701.7329" y2="701.7329"/><polygon fill="#A80036" points="2010.25,697.7329,2000.25,701.7329,2010.25,705.7329,2006.25,701.7329" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1988.25" x2="1988.25" y1="435.5669" y2="470.5669"/><polygon fill="#A80036" points="1984.25,460.5669,1988.25,470.5669,1992.25,460.5669,1988.25,464.5669" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1378.375" x2="870.5" y1="305.7896" y2="305.7896"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="870.5" x2="870.5" y1="305.7896" y2="327.7896"/><polygon fill="#A80036" points="866.5,317.7896,870.5,327.7896,874.5,317.7896,870.5,321.7896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1512.375" x2="1988.25" y1="305.7896" y2="305.7896"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1988.25" x2="1988.25" y1="305.7896" y2="327.7896"/><polygon fill="#A80036" points="1984.25,317.7896,1988.25,327.7896,1992.25,317.7896,1988.25,321.7896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="870.5" x2="870.5" y1="901.0217" y2="919.0217"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="870.5" x2="1433.375" y1="919.0217" y2="919.0217"/><polygon fill="#A80036" points="1423.375,915.0217,1433.375,919.0217,1423.375,923.0217,1427.375,919.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1988.25" x2="1988.25" y1="713.7329" y2="919.0217"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1988.25" x2="1457.375" y1="919.0217" y2="919.0217"/><polygon fill="#A80036" points="1467.375,915.0217,1457.375,919.0217,1467.375,923.0217,1463.375,919.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2380" x2="2380" y1="330.1782" y2="365.1782"/><polygon fill="#A80036" points="2376,355.1782,2380,365.1782,2384,355.1782,2380,359.1782" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1830.6875" x2="1445.375" y1="271.7896" y2="271.7896"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1445.375" x2="1445.375" y1="271.7896" y2="293.7896"/><polygon fill="#A80036" points="1441.375,283.7896,1445.375,293.7896,1449.375,283.7896,1445.375,287.7896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1942.6875" x2="2380" y1="271.7896" y2="271.7896"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2380" x2="2380" y1="271.7896" y2="293.7896"/><polygon fill="#A80036" points="2376,283.7896,2380,293.7896,2384,283.7896,2380,287.7896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1445.375" x2="1445.375" y1="931.0217" y2="949.0217"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1445.375" x2="1874.6875" y1="949.0217" y2="949.0217"/><polygon fill="#A80036" points="1864.6875,945.0217,1874.6875,949.0217,1864.6875,953.0217,1868.6875,949.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2380" x2="2380" y1="401.5669" y2="949.0217"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="2380" x2="1898.6875" y1="949.0217" y2="949.0217"/><polygon fill="#A80036" points="1908.6875,945.0217,1898.6875,949.0217,1908.6875,953.0217,1904.6875,949.0217" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1886.6875" x2="1886.6875" y1="158.0891" y2="259.7896"/><polygon fill="#A80036" points="1882.6875,249.7896,1886.6875,259.7896,1890.6875,249.7896,1886.6875,253.7896" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1886.6875" x2="1886.6875" y1="961.0217" y2="981.0217"/><polygon fill="#A80036" points="1882.6875,971.0217,1886.6875,981.0217,1890.6875,971.0217,1886.6875,975.0217" style="stroke: #A80036; stroke-width: 1.0;"/><!--
@startuml

start

:寻找对比目标;
note right
  React为了提高对比效率，做出以下假设：
  ====
  假设节点不会出现层次的移动（对比时，直接找到旧树中对应位置的节点进行对比）
  ====
  不同的节点类型会生成不同的结构 
  * 相同的节点类型：节点本身类型相同，如果是由React元素生成，type值还必须一致
  * 其他的，都属于不相同的节点类型 
  ====
  多个兄弟通过唯一标识（key）来确定对比的新节点 
  * **key值的作用 **： 用于通过旧节点，寻找对应的新节点，如果某个旧节点有key值，则其更新时，会**寻找相同层级中**的相同key值的节点，进行对比
  * key值应该在一个范围内唯一（兄弟节点中），并且应该保持稳定

end note
if(是否找到对比目标) then(是)
    if(判断节点类型是否一致) then(是)
        :判断节点类型;
        if(空节点)
            :什么都不做;
        elseif(DOM节点)
            :直接重用之前的真实DOM对象;
            :将其属性的变化记录下来，以待将来统一完成更新（现在不会真正的变化）;
            :遍历该新的React元素的子元素，**递归对比更新**;
        elseif(文本节点)
            :直接重用之前的真实DOM对象 ;
            :将新的文本变化记录下来，将来统一完成更新;
        elseif(函数组件)
            :重新调用函数，得到一个节点对象，进入**递归对比更新**;
        elseif(类组件)
            :重用之前的实例 ;
            :调用生命周期方法static getDerivedStateFromProps;
            :调用生命周期方法shouldComponentUpdate;
                if(shouldComponentUpdate返回值) then(false)
                    stop
                else(true)
                    :运行render，得到新的节点对象，进入**递归对比更新**;
                    :将该对象的getSnapshotBeforeUpdate加入队列;
                    :将该对象的componentDidUpdate加入队列;
                endif
        elseif(组件节点)
            :遍历数组进行**递归对比更新**;
        endif
    else(否)
        :创建新节点,进入新节点的渲染流程;
        :卸载旧节点;
        if(节点类型) then(类组件节点)
            :直接放弃该节点;
            :调用该节点的componentWillUnMount函数;
            :递归卸载子节点;
        else(其他节点)
            :直接放弃该节点，如果节点有子节点，递归卸载节点;
        endif
    endif
else(否)
    :创建新加入的节点;
    :卸载多余的旧节点;
endif

stop

@enduml

PlantUML version 1.2019.09(Tue Aug 27 00:19:51 CST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_201-b09
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>