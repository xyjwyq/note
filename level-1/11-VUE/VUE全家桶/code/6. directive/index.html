<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>directive</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

</head>

<body>
    <div id="app">
        <!-- 1 -->
        <!-- <input type="text" v-slice:9.number="content" v-model="content"> -->
        <!-- 2 -->
        <input type="text" v-slice:9.number="content">
        {{content}}
    </div>
    <script>
        // 1

        // Vue.directive('slice', function(el, bindings, vNode) {
        //     // console.log(el);
        //     // console.log(bindings);
        //     // console.log(vNode);
        //     var val = bindings.value.slice(0, 5);
        //     vNode.context.content = val;
        // });

        // Vue.directive('slice', {
        //     bind(el, bindings, vNode) {

        //     },
        //     update(el, bindings, vNode) {

        //     },
        // });

        // 2
        
        Vue.directive('slice', {
            bind(el, bindings, vNode) {
                console.log(bindings);
                const context = vNode.context;
                const sliceLen = bindings.arg || 5;
                const numberFlag = bindings.modifiers.number;
                let value = context[bindings.expression];

                if (numberFlag) {
                    value = value.replace(/[^0-9]/g, '');
                }
                value = value.slice(0, sliceLen);
                el.value = value;
                context[bindings.expression] = value;

                el.oninput = function (e) {
                    let value = e.target.value;
                    if (numberFlag) {
                        value = value.replace(/[^0-9]/g, '');
                    }
                    value = value.slice(0, sliceLen);
                    context[bindings.expression] = value;
                    e.target.value = value;
                }
            },
            update(el, bindings, vNode) {
                const context = vNode.context;
                const sliceLen = bindings.arg || 5;
                const numberFlag = bindings.modifiers.number;
                let value = context[bindings.expression];

                if (numberFlag) {
                    value = value.replace(/[^0-9]/g, '');
                }
                value = value.slice(0, sliceLen);
                el.value = value;
                context[bindings.expression] = value;
            },
            inserted(el) {
                el.focus();
            }
        });

        const vm = new Vue({
            el: '#app',
            data: {
                content: 'jsd43435dfds1'
            },
            methods: {

            },
            // 局部指令
            directives: {
                test: function(el, bindings, vNode) {},
                test2: {
                    bind() {

                    },
                    update() {

                    },
                    inserted() {

                    }
                }
            }
        });
    </script>
</body>

</html>