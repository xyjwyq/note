<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>jsonp原理</title>
</head>

<body>

    <script>
        function ajaxJsonp(option) {
            var url = option.url,
                type = option.type,
                dataType = option.dataType;
            // 判断是否同源
            var targetProtocol = '', // 目标协议
                targetHost = ''; // 目标域名
            // 如果url不带http，那么访问的一定是相对路径，相对路径一定同源
            if (url.indexOf('http://') === 0 || url.indexOf('https://') === 0) {
                var targetUrl = new URL(url);
                targetProtocol = targetUrl.protocol;
                targetHost = targetUrl.host;
            } else {
                targetProtocol = location.protocol;
                targetHost = location.host;
            }
            // 判断请求是不是jsonp，若不是，则直接发送ajax请求
            if (dataType === 'jsonp') {
                // 判断是否同源，若否则直接发送ajax请求
                if (targetProtocol === location.protocol && targetProtocol === location.host) {
                    // 此处省略，因为同源，jsonp会仿作普通的ajax请求
                } else {
                    // 生成随机的callback
                    var callback = 'cb' + Math.floor(Math.random() * 1000000);
                    // 创建一个callback函数
                    window[callback] = option.success;
                    // 生成script标签
                    var script = document.createElement('script');
                    // 判断url中是否带有参数，确定callback拼接方式
                    var param = url.indexOf('?') === -1 ? '?callback=' + callback : '&callback=' + callback;
                    script.src = url + param;
                    // 将script元素插入页面
                    document.head.appendChild(script);
                }
            } else {
                // 直接发送ajax请求
            }

        }

        ajaxJsonp({
            url: 'http://developer.duyiedu.com/edu/testJsonp',
            type: 'get',
            dataType: 'jsonp',
            success: function (data) {
                console.log(data);
            }
        });
    </script>

</body>

</html>